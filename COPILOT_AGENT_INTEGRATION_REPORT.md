# Copilot Agent é›†æˆå®ŒæˆæŠ¥å‘Š

## ğŸ‰ é¡¹ç›®æ¦‚è¿°

Copilot Agent æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ Agent ç³»ç»Ÿï¼Œä¸º copilot_client_app æä¾›å¤šè½®å¯¹è¯å’Œå·¥å…·è°ƒç”¨èƒ½åŠ›ã€‚

## âœ… å·²å®Œæˆå·¥ä½œ

### é˜¶æ®µ 1: çœŸå®å·¥å…·å®ç°

**æ–‡ä»¶ç³»ç»Ÿå·¥å…·** (`copilot-agent-mcp/src/tools/filesystem.rs`)
- `read_file` - è¯»å–æ–‡ä»¶å†…å®¹
- `write_file` - å†™å…¥æ–‡ä»¶ï¼ˆè‡ªåŠ¨åˆ›å»ºç›®å½•ï¼‰
- `list_directory` - åˆ—å‡ºç›®å½•å†…å®¹
- `file_exists` - æ£€æŸ¥æ–‡ä»¶å­˜åœ¨
- `get_file_info` - è·å–æ–‡ä»¶è¯¦ç»†ä¿¡æ¯

**å‘½ä»¤æ‰§è¡Œå·¥å…·** (`copilot-agent-mcp/src/tools/command.rs`)
- `execute_command` - æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼ˆ30ç§’è¶…æ—¶ï¼‰
- `get_current_dir` - è·å–å½“å‰ç›®å½•
- å±é™©å‘½ä»¤æ‹¦æˆªï¼ˆrm -rf / ç­‰ï¼‰
- è·¯å¾„å®‰å…¨æ£€æŸ¥

**MCP Client** (`copilot-agent-mcp/src/client.rs`)
- å®Œæ•´å·¥å…·åˆ†å‘é€»è¾‘
- å‚æ•°è§£æå’ŒéªŒè¯
- 7ä¸ªå¯ç”¨å·¥å…·

### é˜¶æ®µ 2: Skill ç³»ç»Ÿé›†æˆ

**Skill Loader** (`copilot-agent-server/src/skill_loader.rs`)
- ä» `~/.bodhi/skills/*.json` åŠ è½½ skills
- ç³»ç»Ÿæç¤ºè¯æ„å»º
- å·¥å…· schema æå–

**State é›†æˆ** (`copilot-agent-server/src/state.rs`)
- è‡ªåŠ¨åŠ è½½å¯ç”¨ skills
- åˆå¹¶åŸºç¡€å·¥å…·å’Œ skill å·¥å…·
- å¢å¼ºç³»ç»Ÿæç¤ºè¯

**AgentLoop å¢å¼º** (`copilot-agent-server/src/agent_runner.rs`)
- `AgentLoopConfig` é…ç½®
- ç³»ç»Ÿæç¤ºè¯æ”¯æŒ
- å‘åå…¼å®¹

### é˜¶æ®µ 3: ä¸»é¡¹ç›®é›†æˆ

**å‰ç«¯æœåŠ¡** (`src/pages/ChatPage/services/AgentService.ts`)
- `AgentClient` HTTP å®¢æˆ·ç«¯
- SSE æµå¼äº‹ä»¶å¤„ç†
- å®Œæ•´çš„ Agent API å°è£…

**React Hooks**
- `useAgentChat.ts` - Agent ä¸“ç”¨ hook
- `useChatStreaming.ts` - ç»Ÿä¸€æµå¼å¤„ç†ï¼ˆAgent ä¼˜å…ˆï¼ŒOpenAI å›é€€ï¼‰
- `useChatManager/index.ts` - é›†æˆæ›´æ–°

**UI çŠ¶æ€æ˜¾ç¤º** (`src/pages/ChatPage/components/InputContainer/index.tsx`)
- Agent æ¨¡å¼æŒ‡ç¤ºå™¨ï¼ˆå³ä¸Šè§’ Tagï¼‰
- ä¸‰ç§çŠ¶æ€ï¼šChecking... / Agent Mode / Direct Mode

**å¯åŠ¨è„šæœ¬** (`scripts/start-dev.sh`)
- ä¸€é”®å¯åŠ¨ Agent Server + Tauri App
- è‡ªåŠ¨æ£€æµ‹ç«¯å£å¯ç”¨æ€§

## ğŸ“ å…³é”®æ–‡ä»¶ä½ç½®

### Agent åç«¯
```
crates/copilot-agent/
â”œâ”€â”€ crates/
â”‚   â”œâ”€â”€ copilot-agent-core/       # æ ¸å¿ƒç±»å‹å’Œé€»è¾‘
â”‚   â”œâ”€â”€ copilot-agent-llm/        # LLM Provider (OpenAI)
â”‚   â”œâ”€â”€ copilot-agent-mcp/        # MCP å·¥å…·å®¢æˆ·ç«¯
â”‚   â””â”€â”€ copilot-agent-server/     # HTTP Server
â””â”€â”€ scripts/e2e-simple.sh         # æµ‹è¯•è„šæœ¬
```

### å‰ç«¯é›†æˆ
```
src/pages/ChatPage/
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ AgentService.ts           # Agent HTTP å®¢æˆ·ç«¯
â”‚   â””â”€â”€ SkillService.ts           # Skill ç®¡ç†
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useChatManager/index.ts   # ä¸» hookï¼ˆå·²æ›´æ–°ï¼‰
â”‚   â””â”€â”€ useChatManager/useChatStreaming.ts  # æµå¼å¤„ç†
â””â”€â”€ components/InputContainer/
    â””â”€â”€ index.tsx                 # UI çŠ¶æ€æŒ‡ç¤ºå™¨
```

### Skill æ–‡ä»¶
```
~/.bodhi/skills/
â”œâ”€â”€ file-assistant.json           # æ–‡ä»¶æ“ä½œåŠ©æ‰‹
â””â”€â”€ shell-helper.json             # Shell å‘½ä»¤åŠ©æ‰‹
```

## ğŸš€ å¯åŠ¨æ–¹å¼

### æ–¹æ³• 1: ä¸€é”®å¯åŠ¨ï¼ˆæ¨èï¼‰
```bash
cd ~/workspace/copilot_client_app
./scripts/start-dev.sh
```

### æ–¹æ³• 2: æ‰‹åŠ¨å¯åŠ¨
```bash
# ç»ˆç«¯ 1: å¯åŠ¨ Agent Server
cd ~/workspace/copilot_client_app/crates/copilot-agent
./target/release/copilot-agent-server --port 8081

# ç»ˆç«¯ 2: å¯åŠ¨ Tauri App
cd ~/workspace/copilot_client_app
npm run tauri dev
```

## ğŸ”Œ ç«¯å£é…ç½®

| æœåŠ¡ | ç«¯å£ | è¯´æ˜ |
|------|------|------|
| web_service | 8080 | åŸåç«¯æœåŠ¡ |
| copilot-agent-server | 8081 | Agent æœåŠ¡ |
| Tauri App | 1420 | å‰ç«¯å¼€å‘æœåŠ¡å™¨ |

## ğŸ§ª æµ‹è¯•éªŒè¯

```bash
# åç«¯æµ‹è¯•
cd ~/workspace/copilot_client_app/crates/copilot-agent
bash scripts/e2e-simple.sh

# TypeScript æ£€æŸ¥
cd ~/workspace/copilot_client_app
npx tsc --noEmit
```

## ğŸ“Š ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Frontend (Tauri App)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  useChatManager                                        â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  useChatStreaming                                â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ AgentClient â”‚â”€â”€â”€â–¶â”‚ localhost:8081       â”‚     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  (HTTP+SSE) â”‚â—€â”€â”€â”€â”‚ /api/v1/chat         â”‚     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ /api/v1/stream/{id}  â”‚     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                           â”‚                      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  Fallback: direct OpenAI  â”‚                      â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              copilot-agent-server (localhost:8081)          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ State                                                â”‚   â”‚
â”‚  â”‚  - skill_loader: SkillLoader                         â”‚   â”‚
â”‚  â”‚  - loaded_skills: [file-assistant, shell-helper]     â”‚   â”‚
â”‚  â”‚  - llm: OpenAIProvider                               â”‚   â”‚
â”‚  â”‚  - tools: McpClient (7 tools)                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ AgentLoop             â”‚                              â”‚   â”‚
â”‚  â”‚  - System Prompt + Skills Context                    â”‚   â”‚
â”‚  â”‚  - Base Tools (7) + Skill Tool Refs                  â”‚   â”‚
â”‚  â”‚  - Multi-turn execution                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LLM API (localhost:12123)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ ç‰¹æ€§

- âœ… **Agent ä¼˜å…ˆ**: è‡ªåŠ¨æ£€æµ‹å¹¶ä½¿ç”¨ Agent Server
- âœ… **OpenAI å›é€€**: Agent ä¸å¯ç”¨æ—¶è‡ªåŠ¨åˆ‡æ¢
- âœ… **å¤šè½®å·¥å…·æ‰§è¡Œ**: Agent æ”¯æŒå¤šè½®å¯¹è¯å’Œå·¥å…·è°ƒç”¨
- âœ… **Skill ç³»ç»Ÿ**: åŠ¨æ€åŠ è½½å’Œå¯ç”¨ skills
- âœ… **SSE æµå¼**: å®æ—¶ Token å’Œäº‹ä»¶æµ
- âœ… **UI çŠ¶æ€æ˜¾ç¤º**: æ˜¾ç¤ºå½“å‰ä½¿ç”¨çš„åç«¯æ¨¡å¼
- âœ… **TypeScript**: å®Œæ•´çš„ç±»å‹æ”¯æŒ

## ğŸ”§ æŠ€èƒ½æ–‡ä»¶æ ¼å¼

```json
{
  "id": "skill-id",
  "name": "Skill Name",
  "description": "Description",
  "category": "category",
  "tags": ["tag1", "tag2"],
  "prompt": "System prompt for this skill",
  "tool_refs": ["read_file", "execute_command"],
  "workflow_refs": [],
  "visibility": "public",
  "enabled_by_default": true,
  "version": "1.0.0",
  "created_at": "2024-01-01T00:00:00Z",
  "updated_at": "2024-01-01T00:00:00Z"
}
```

## ğŸ“ˆ çŠ¶æ€æŒ‡ç¤ºå™¨

| çŠ¶æ€ | é¢œè‰² | è¯´æ˜ |
|------|------|------|
| Checking... | é»˜è®¤ | æ­£åœ¨æ£€æµ‹ Agent Server |
| Agent Mode | ç»¿è‰² | ä½¿ç”¨ Agent Server (localhost:8081) |
| Direct Mode | æ©™è‰² | ä½¿ç”¨ç›´æ¥ OpenAI è°ƒç”¨ |

## ğŸŠ å®Œæˆæ€»ç»“

æ‰€æœ‰ä»»åŠ¡å·²å®Œæˆï¼ç³»ç»Ÿå·²å°±ç»ªï¼š
- âœ… åç«¯ç¼–è¯‘é€šè¿‡
- âœ… TypeScript æ£€æŸ¥é€šè¿‡
- âœ… E2E æµ‹è¯•é€šè¿‡
- âœ… Skill åŠ è½½éªŒè¯é€šè¿‡
- âœ… å‰ç«¯é›†æˆå®Œæˆ
- âœ… UI çŠ¶æ€æ˜¾ç¤ºå®Œæˆ
- âœ… å¯åŠ¨è„šæœ¬åˆ›å»ºå®Œæˆ

**ç³»ç»Ÿå·²å‡†å¤‡å¥½è¿›è¡Œç«¯åˆ°ç«¯æµ‹è¯•ï¼** ğŸš€
