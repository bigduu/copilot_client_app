# 当前上下文

## 当前工作焦点

**错误修复与重构后清理**。在上次重大的 "动态 Prompt 与用户自定义" 架构重构后，出现了一系列前后端不一致的错误。本次任务的焦点是修复这些错误，并清理重构后遗留的过时代码。

## 最近的变更

- **修复了React无限渲染循环**:
  - 在 `SystemPromptSelector` 组件中，通过将 `useAppStore` 的调用拆分为多个独立的选择器，解决了因每次渲染创建新对象而导致的 `Maximum update depth exceeded` 错误。
- **修复了API调用逻辑**:
  - 重构了 `SystemPromptService`，将其中的 Tauri `invoke` 调用替换为对本地 Web 服务 (`http://localhost:8080/tools/available`) 的 `fetch` 调用。
  - 更新了服务内部的类型定义，以匹配新的后端数据结构，解决了所有相关的类型错误。
- **统一了工具 API (续)**:
  - 上述 `SystemPromptService` 的修改进一步统一了前端与后端 Web 服务的通信方式，完全弃用了通过 `invoke` 获取业务数据的模式。

## 下一步

- 等待用户的下一个任务指令。

## 重要模式和偏好

- **文档优先**: 在执行任何重要任务之前，必须确保相关的记忆银行文件是最新的。
- **结构化**: 所有记忆银行文件都应遵循清晰的、基于Markdown的结构，使用标题和列表来组织信息。
- **原子性**: 每个记忆银行文件都应专注于一个特定的领域（例如，产品、技术、进度）。

## 学习与洞察

- **重构后的验证至关重要**: 大规模重构后，必须进行端到端的测试，以确保前后端接口的一致性。本次修复的大部分工作都是在弥补重构后验证不足的问题。
- **单一数据源的正确使用**: 组件应优先通过 props 接收数据。只有在组件是数据的所有者或修改者时，才应直接与状态管理库（如 Zustand）交互。这可以避免不必要的渲染和 React 警告。
