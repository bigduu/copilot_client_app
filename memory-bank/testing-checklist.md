# ğŸ§ª MessageProcessoræµ‹è¯•æ£€æŸ¥æ¸…å•

## ğŸ” ç«‹å³å¯æµ‹è¯•çš„åŠŸèƒ½

### **1. æ§åˆ¶å°æ—¥å¿—éªŒè¯**
å¯åŠ¨åº”ç”¨åå‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
```
[MessageProcessor] Initializing tools...
[MessageProcessor] Loaded X tools
[useMessages] Processing message through MessageProcessor
[MessageProcessor] Enhancing system prompt with tool information
[useMessages] Message preprocessed, enhanced messages count: X
[useMessages] Sending preprocessed messages to backend
```

### **2. ç½‘ç»œè¯·æ±‚æ£€æŸ¥**
åœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„Networkæ ‡ç­¾é¡µä¸­ï¼š
- æŸ¥æ‰¾ `execute_prompt` è¯·æ±‚
- æ£€æŸ¥è¯·æ±‚payloadä¸­çš„`messages`æ•°ç»„
- ç¬¬ä¸€ä¸ªmessageåº”è¯¥æ˜¯role="system"ï¼ŒcontentåŒ…å«å·¥å…·ä¿¡æ¯

### **3. ç³»ç»Ÿæç¤ºå†…å®¹éªŒè¯**
ç³»ç»Ÿæ¶ˆæ¯åº”è¯¥åŒ…å«ç±»ä¼¼å†…å®¹ï¼š
```
=== Available Tools ===

**Local Tools:**
- read_file: è¯»å–æ–‡ä»¶å†…å®¹
- create_file: åˆ›å»ºæ–°æ–‡ä»¶
- ...

**MCP Tools:**
- (å¦‚æœæœ‰MCPæœåŠ¡å™¨è¿æ¥)

ä½¿ç”¨æ–¹å¼ï¼šå½“éœ€è¦ä½¿ç”¨å·¥å…·æ—¶ï¼Œè¯·åœ¨å›å¤ä¸­åŒ…å«JSONæ ¼å¼ï¼š
{"use_tool": true, "tool_type": "local|mcp", "tool_name": "å·¥å…·å", "parameters": {...}}
```

## ğŸš€ å·¥å…·è°ƒç”¨æµ‹è¯•

### **æµ‹è¯•æ¶ˆæ¯ç¤ºä¾‹**ï¼š
1. **è¯»å–æ–‡ä»¶**: "è¯·å¸®æˆ‘è¯»å–package.jsonæ–‡ä»¶çš„å†…å®¹"
2. **æœç´¢æ–‡ä»¶**: "è¯·æœç´¢é¡¹ç›®ä¸­åŒ…å«'MessageProcessor'çš„æ–‡ä»¶"
3. **åˆ›å»ºæ–‡ä»¶**: "è¯·åˆ›å»ºä¸€ä¸ªtest.txtæ–‡ä»¶ï¼Œå†…å®¹æ˜¯'Hello World'"

### **é¢„æœŸè¡Œä¸º**ï¼š
1. AIåº”è¯¥è¯†åˆ«åˆ°å¯ç”¨å·¥å…·
2. å›å¤ä¸­åŒ…å«å·¥å…·è°ƒç”¨JSON
3. å‰ç«¯è‡ªåŠ¨è§£æå¹¶æ‰§è¡Œï¼ˆå®‰å…¨å·¥å…·ï¼‰æˆ–æ˜¾ç¤ºç¡®è®¤ï¼ˆå±é™©å·¥å…·ï¼‰
4. å·¥å…·æ‰§è¡Œç»“æœæ˜¾ç¤ºåœ¨èŠå¤©ä¸­

## ğŸ› ï¸ æ•…éšœæ’é™¤

### **å¦‚æœå·¥å…·ä¿¡æ¯æ²¡æœ‰å‡ºç°åœ¨ç³»ç»Ÿæç¤ºä¸­**ï¼š
1. æ£€æŸ¥ `get_all_available_tools` å‘½ä»¤æ˜¯å¦æ­£å¸¸å·¥ä½œ
2. æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰MessageProcessoråˆå§‹åŒ–é”™è¯¯
3. æ£€æŸ¥toolParser.parseXmlToolListæ˜¯å¦æ­£ç¡®è§£æ

### **å¦‚æœå·¥å…·è°ƒç”¨æ²¡æœ‰è¢«è§£æ**ï¼š
1. æ£€æŸ¥AIå›å¤çš„æ ¼å¼æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥toolParser.parseToolCallsFromContentçš„æ­£åˆ™è¡¨è¾¾å¼
3. æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰è§£æé”™è¯¯

### **å¦‚æœå·¥å…·æ‰§è¡Œå¤±è´¥**ï¼š
1. æ£€æŸ¥åç«¯å·¥å…·APIæ˜¯å¦æ­£å¸¸å·¥ä½œ
2. æ£€æŸ¥å·¥å…·å‚æ•°æ ¼å¼æ˜¯å¦æ­£ç¡®
3. æ£€æŸ¥invokeè°ƒç”¨çš„é”™è¯¯ä¿¡æ¯

## âœ… æˆåŠŸæ ‡å¿—

- [ ] æ§åˆ¶å°æ˜¾ç¤ºå·¥å…·åŠ è½½æˆåŠŸ
- [ ] ç½‘ç»œè¯·æ±‚åŒ…å«å¢å¼ºçš„ç³»ç»Ÿæç¤º
- [ ] AIèƒ½è¯†åˆ«å¹¶ä½¿ç”¨å·¥å…·
- [ ] å·¥å…·æ‰§è¡Œç»“æœæ­£ç¡®æ˜¾ç¤º
- [ ] å±é™©å·¥å…·æ˜¾ç¤ºç¡®è®¤ç•Œé¢

## ğŸ”§ è°ƒè¯•æŠ€å·§

### **å¯ç”¨è¯¦ç»†æ—¥å¿—**ï¼š
åœ¨MessageProcessor.tsä¸­çš„æ‰€æœ‰console.logéƒ½åº”è¯¥æ˜¾ç¤ºï¼Œå¦‚æœæ²¡æœ‰ï¼š
1. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°è¿‡æ»¤è®¾ç½®
2. æ£€æŸ¥MessageProcessoræ˜¯å¦è¢«æ­£ç¡®åˆå§‹åŒ–

### **æ£€æŸ¥çŠ¶æ€**ï¼š
åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­è¿è¡Œï¼š
```javascript
// æ£€æŸ¥MessageProcessorçŠ¶æ€
console.log(window.__messageProcessorDebug);
```

### **æ‰‹åŠ¨æµ‹è¯•å·¥å…·API**ï¼š
```javascript
// åœ¨æ§åˆ¶å°æµ‹è¯•å·¥å…·åˆ—è¡¨API
invoke('get_all_available_tools').then(console.log);

// æµ‹è¯•å·¥å…·æ‰§è¡ŒAPI
invoke('execute_local_tool', {
  tool_name: 'read_file',
  parameters: [{ name: 'path', value: 'package.json', description: '', required: true }]
}).then(console.log);
```

## ğŸ¯ æ ¸å¿ƒéªŒè¯ç‚¹

**æœ€é‡è¦çš„éªŒè¯**ï¼šå‘é€æ¶ˆæ¯æ—¶ï¼Œåœ¨Networké¢æ¿ä¸­æ£€æŸ¥`execute_prompt`è¯·æ±‚çš„messagesæ•°ç»„ï¼Œç¡®è®¤ç¬¬ä¸€ä¸ªç³»ç»Ÿæ¶ˆæ¯åŒ…å«äº†å·¥å…·ä¿¡æ¯ã€‚

å¦‚æœè¿™ä¸ªéªŒè¯é€šè¿‡ï¼Œè¯´æ˜æˆ‘ä»¬å®Œå…¨è§£å†³äº†æ‚¨æœ€åˆå‘ç°çš„é—®é¢˜ï¼ ğŸ‰
