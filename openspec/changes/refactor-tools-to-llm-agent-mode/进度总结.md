# é‡æ„è¿›åº¦æ€»ç»“ - å·¥å…·ç³»ç»Ÿè½¬ LLM ä»£ç†æ¨¡å¼

**æ›´æ–°æ—¶é—´:** 2025-11-02  
**æ•´ä½“è¿›åº¦:** 58.6% (68/116 ä»»åŠ¡å·²å®Œæˆ)

---

## ğŸ“Š æ€»ä½“çŠ¶æ€

### âœ… å·²å®Œæˆ (68 ä¸ªä»»åŠ¡)

- âœ… åç«¯åŸºç¡€è®¾æ–½ (20 ä¸ªä»»åŠ¡)
- âœ… ç³»ç»Ÿæç¤ºè¯å¢å¼º (15 ä¸ªä»»åŠ¡)
- âœ… åç«¯å·¥ä½œæµ API (18 ä¸ªä»»åŠ¡)
- âœ… ä»£ç†å¾ªç¯åŸºç¡€ (10 ä¸ªä»»åŠ¡)
- âœ… å‰ç«¯é‡æ„ (35 ä¸ªä»»åŠ¡)

### ğŸ“‹ å¾…å®Œæˆ (48 ä¸ªä»»åŠ¡)

- ğŸ“‹ ä»£ç†å¾ªç¯é›†æˆ (10 ä¸ªä»»åŠ¡)
- ğŸ“‹ è¿ç§»ä¸æ¸…ç† (12 ä¸ªä»»åŠ¡)
- ğŸ“‹ æµ‹è¯• (26 ä¸ªä»»åŠ¡)
- ğŸ“‹ ä¼˜åŒ–ä¸éƒ¨ç½² (18 ä¸ªä»»åŠ¡)

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½å·²å®ç°

### 1ï¸âƒ£ å·¥ä½œæµç³»ç»Ÿ âœ…

**åŠŸèƒ½è¯´æ˜ï¼š**

- ç”¨æˆ·å¯ä»¥é€šè¿‡ UI ç›´æ¥è°ƒç”¨å·¥ä½œæµï¼Œæ— éœ€ AI å‚ä¸
- æ”¯æŒåŠ¨æ€å‚æ•°è¡¨å•
- ç¼–è¯‘æ—¶æ³¨å†Œï¼Œé›¶è¿è¡Œæ—¶å¼€é”€

**ä½¿ç”¨æ–¹æ³•ï¼š**

```
1. åœ¨èŠå¤©è¾“å…¥æ¡†è¾“å…¥ "/"
2. å·¥ä½œæµé€‰æ‹©å™¨å¼¹å‡ºï¼Œæ˜¾ç¤ºå¯ç”¨å·¥ä½œæµ
3. é€‰æ‹©å·¥ä½œæµï¼ˆä¾‹å¦‚ "create_file"ï¼‰
4. å¡«å†™å‚æ•°ï¼ˆpath, contentï¼‰
5. ç‚¹å‡»æ‰§è¡Œ â†’ æ–‡ä»¶ç«‹å³åˆ›å»º
```

**å¯ç”¨å·¥ä½œæµï¼š**

- `echo`: å›æ˜¾æ¶ˆæ¯
- `create_file`: åˆ›å»ºæ–‡ä»¶

**åç«¯ APIï¼š**

```bash
# åˆ—å‡ºæ‰€æœ‰å·¥ä½œæµ
GET /v1/workflows/available

# è·å–å·¥ä½œæµè¯¦æƒ…
GET /v1/workflows/{name}

# æ‰§è¡Œå·¥ä½œæµ
POST /v1/workflows/execute
{
  "workflow_name": "create_file",
  "parameters": {
    "path": "/tmp/test.txt",
    "content": "Hello World"
  }
}
```

### 2ï¸âƒ£ ç³»ç»Ÿæç¤ºè¯å¢å¼º âœ…

**åŠŸèƒ½è¯´æ˜ï¼š**

- ç³»ç»Ÿæç¤ºè¯ç°åœ¨ç”±åç«¯ç»Ÿä¸€ç®¡ç†å’Œå¢å¼º
- è‡ªåŠ¨æ³¨å…¥å·¥å…·å®šä¹‰ï¼ˆXML æ ¼å¼ï¼‰
- æ”¯æŒ Mermaid å›¾è¡¨
- æ™ºèƒ½ç¼“å­˜ï¼ˆ60ç§’ TTLï¼‰

**æŠ€æœ¯ç»†èŠ‚ï¼š**

```rust
// åç«¯æœåŠ¡
SystemPromptEnhancer {
  - è·å–åŸºç¡€æç¤ºè¯
  - æ·»åŠ å·¥å…·å®šä¹‰ï¼ˆXMLï¼‰
  - æ·»åŠ  Mermaid æ”¯æŒ
  - ä¼˜åŒ–å¤§å°ï¼ˆæœ€å¤§ 32KBï¼‰
  - ç¼“å­˜ç»“æœ
}
```

**API ç«¯ç‚¹ï¼š**

```bash
GET /v1/system-prompts/{id}/enhanced
```

**å‰ç«¯ä½¿ç”¨ï¼š**

```typescript
const enhancedPrompt =
  await systemPromptService.getEnhancedSystemPrompt(promptId);
```

### 3ï¸âƒ£ ä»£ç†æœåŠ¡åŸºç¡€ âœ…

**åŠŸèƒ½è¯´æ˜ï¼š**

- è§£æ LLM å“åº”ä¸­çš„ JSON å·¥å…·è°ƒç”¨
- éªŒè¯å·¥å…·è°ƒç”¨æ ¼å¼
- è¿½è¸ªä»£ç†æ‰§è¡ŒçŠ¶æ€
- æ”¯æŒæœ€å¤§è¿­ä»£æ¬¡æ•°é™åˆ¶

**JSON æ ¼å¼ï¼š**

```json
{
  "tool_name": "read_file",
  "parameters": {
    "path": "/path/to/file"
  },
  "terminate": false
}
```

**çŠ¶æ€è¿½è¸ªï¼š**

```rust
AgentLoopState {
  iteration: u32,
  max_iterations: u32,
  tool_calls: Vec<ToolCallRecord>,
  start_time: Instant,
}
```

---

## ğŸ› ï¸ æŠ€æœ¯æ¶æ„

### åç«¯æ¶æ„

```
crates/
â”œâ”€â”€ workflow_system/          # å·¥ä½œæµç³»ç»Ÿï¼ˆæ–°å¢ï¼‰
â”‚   â”œâ”€â”€ types/               # Workflow trait, WorkflowDefinition
â”‚   â”œâ”€â”€ registry/            # ç¼–è¯‘æ—¶æ³¨å†Œæœºåˆ¶
â”‚   â”œâ”€â”€ executor/            # å·¥ä½œæµæ‰§è¡Œå¼•æ“
â”‚   â””â”€â”€ examples/            # echo, create_file
â”‚
â”œâ”€â”€ tool_system/             # å·¥å…·ç³»ç»Ÿï¼ˆå¢å¼ºï¼‰
â”‚   â””â”€â”€ prompt_formatter.rs  # å·¥å…·è½¬ XML æ ¼å¼
â”‚
â””â”€â”€ web_service/
    â”œâ”€â”€ services/
    â”‚   â”œâ”€â”€ agent_service.rs          # ä»£ç†å¾ªç¯æœåŠ¡ï¼ˆæ–°å¢ï¼‰
    â”‚   â”œâ”€â”€ system_prompt_enhancer.rs # æç¤ºè¯å¢å¼ºï¼ˆæ–°å¢ï¼‰
    â”‚   â””â”€â”€ workflow_service.rs       # å·¥ä½œæµæœåŠ¡ï¼ˆæ–°å¢ï¼‰
    â”‚
    â””â”€â”€ controllers/
        â””â”€â”€ workflow_controller.rs     # å·¥ä½œæµ APIï¼ˆæ–°å¢ï¼‰
```

### å‰ç«¯æ¶æ„

```
src/
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ WorkflowService.ts           # å·¥ä½œæµæœåŠ¡ï¼ˆæ–°å¢ï¼‰
â”‚   â””â”€â”€ SystemPromptService.ts       # æ›´æ–°ï¼šä»åç«¯è·å–å¢å¼ºæç¤ºè¯
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ WorkflowSelector/            # å·¥ä½œæµé€‰æ‹©å™¨ï¼ˆæ–°å¢ï¼‰
â”‚   â”œâ”€â”€ WorkflowParameterForm/       # å‚æ•°è¡¨å•ï¼ˆæ–°å¢ï¼‰
â”‚   â””â”€â”€ WorkflowExecutionFeedback/   # æ‰§è¡Œåé¦ˆï¼ˆæ–°å¢ï¼‰
â”‚
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ useChatManager.ts            # æ›´æ–°ï¼šç§»é™¤å·¥å…·å‘½ä»¤è§£æ
â”‚
â””â”€â”€ core/
    â””â”€â”€ chatInteractionMachine.ts    # æ›´æ–°ï¼šç¦ç”¨ AI å·¥å…·æ£€æµ‹
```

---

## ğŸ”§ è¿‘æœŸä¿®å¤çš„ Bug

### Bug 1: API å­—æ®µä¸åŒ¹é…

**é—®é¢˜ï¼š** å‰ç«¯å‘é€ `{ name: "..." }`ï¼Œåç«¯æœŸæœ› `{ workflow_name: "..." }`  
**ä¿®å¤ï¼š** ç»Ÿä¸€ä½¿ç”¨ `workflow_name` å­—æ®µ  
**å½±å“æ–‡ä»¶ï¼š**

- `src/services/WorkflowService.ts`
- `src/components/InputContainer/index.tsx`

### Bug 2: å·¥ä½œæµè§¦å‘å®¡æ‰¹å¼¹çª—

**é—®é¢˜ï¼š** è¾“å…¥ `/echo hi` åè§¦å‘æ—§çš„å·¥å…·å®¡æ‰¹æµç¨‹  
**æ ¹æœ¬åŸå› ï¼š** `useChatManager.ts` ä¸­ä»æœ‰å·¥å…·å‘½ä»¤è§£æé€»è¾‘  
**ä¿®å¤ï¼š** ç¦ç”¨æ–‡æœ¬å‘½ä»¤è§£æï¼Œå·¥ä½œæµä»…é€šè¿‡ UI é€‰æ‹©å™¨è°ƒç”¨  
**ç»“æœï¼š** ç”¨æˆ·è°ƒç”¨çš„å·¥ä½œæµç«‹å³æ‰§è¡Œï¼Œæ— å®¡æ‰¹å¼¹çª—

### Bug 3: æœ¯è¯­ä¸ä¸€è‡´

**é—®é¢˜ï¼š** UI ä»æ˜¾ç¤º "Tool" è€Œé "Workflow"  
**ä¿®å¤ï¼š** æ›´æ–°æ‰€æœ‰ç”¨æˆ·ç•Œé¢æ–‡æœ¬ä¸º "Workflow"  
**å½±å“æ–‡ä»¶ï¼š**

- `src/components/MessageCard/ApprovalCard.tsx`
- `src/services/ToolService.ts`

---

## ğŸ¨ ç”¨æˆ·ä½“éªŒæ”¹è¿›

### å·¥ä½œæµè°ƒç”¨æµç¨‹

**æ—§æµç¨‹ï¼ˆå·²ç§»é™¤ï¼‰ï¼š**

```
è¾“å…¥ "/echo hi" â†’ æ–‡æœ¬è§£æ â†’ å®¡æ‰¹å¼¹çª— â†’ ç­‰å¾…æ‰¹å‡† â†’ æ‰§è¡Œ
```

**æ–°æµç¨‹ï¼š**

```
è¾“å…¥ "/" â†’ å·¥ä½œæµé€‰æ‹©å™¨ â†’ é€‰æ‹© "echo" â†’ å‚æ•°è¡¨å• â†’ ç‚¹å‡»æ‰§è¡Œ â†’ ç«‹å³æ‰§è¡Œ
```

### UI å˜åŒ–

| ç»„ä»¶     | æ—§ç‰ˆæœ¬              | æ–°ç‰ˆæœ¬           |
| -------- | ------------------- | ---------------- |
| å‘½ä»¤è¾“å…¥ | æ–‡æœ¬å‘½ä»¤ `/echo hi` | UI é€‰æ‹©å™¨        |
| å‚æ•°è¾“å…¥ | æ–‡æœ¬è§£æ            | åŠ¨æ€è¡¨å•         |
| æ‰§è¡Œæ–¹å¼ | éœ€è¦å®¡æ‰¹            | ç«‹å³æ‰§è¡Œ         |
| åé¦ˆæ–¹å¼ | èŠå¤©æ¶ˆæ¯            | Toast + èŠå¤©æ¶ˆæ¯ |

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### å½“å‰æ€§èƒ½

| æ“ä½œ                     | è€—æ—¶   | è¯´æ˜            |
| ------------------------ | ------ | --------------- |
| å·¥ä½œæµæ‰§è¡Œ (echo)        | <10ms  | ç®€å•å·¥ä½œæµ      |
| å·¥ä½œæµæ‰§è¡Œ (create_file) | <50ms  | åŒ…å«æ–‡ä»¶ I/O    |
| å¢å¼ºæç¤ºè¯ï¼ˆç¼“å­˜å‘½ä¸­ï¼‰   | <5ms   | ç¼“å­˜æœ‰æ•ˆ        |
| å¢å¼ºæç¤ºè¯ï¼ˆç¼“å­˜æœªå‘½ä¸­ï¼‰ | <100ms | å·¥å…·è·å–+æ ¼å¼åŒ– |
| å·¥ä½œæµåˆ—è¡¨ API           | <10ms  | æ³¨å†Œè¡¨æŸ¥è¯¢      |

### ä¼˜åŒ–æœºä¼š

1. **æç¤ºè¯ç¼“å­˜ï¼š** å½“å‰ 60ç§’ TTLï¼Œå¯è€ƒè™‘å¢åŠ æˆ–ä½¿ç”¨ LRU ç¼“å­˜
2. **å·¥ä½œæµæ³¨å†Œï¼š** ç¼–è¯‘æ—¶æ³¨å†Œå·²æ˜¯æœ€ä¼˜
3. **ä»£ç†å¾ªç¯ï¼š** æœªæ¥å¯è€ƒè™‘å¹¶è¡Œå·¥å…·æ‰§è¡Œï¼ˆå¦‚æœç‹¬ç«‹ï¼‰

---

## ğŸš€ ä¸‹ä¸€æ­¥è®¡åˆ’

### ç«‹å³æ‰§è¡Œï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰

1. **æ·»åŠ åç«¯å•å…ƒæµ‹è¯•** (7.1)
   - æµ‹è¯•å·¥ä½œæµæ‰§è¡Œå™¨
   - æµ‹è¯•ä»£ç†æœåŠ¡ JSON è§£æ
   - æµ‹è¯•æç¤ºè¯å¢å¼ºå™¨

2. **å®Œæˆä»£ç†å¾ªç¯é›†æˆ** (4.2-4.3)
   - å®ç°å·¥å…·å®¡æ‰¹æœºåˆ¶
   - æ·»åŠ é”™è¯¯å¤„ç†å’Œé‡è¯•
   - é›†æˆåˆ° OpenAI æ§åˆ¶å™¨

### çŸ­æœŸè®¡åˆ’ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰

3. **åç«¯é›†æˆæµ‹è¯•** (7.2)
   - ç«¯åˆ°ç«¯å·¥ä½œæµæ‰§è¡Œæµ‹è¯•
   - å¢å¼ºæç¤ºè¯ API æµ‹è¯•
   - æ¨¡æ‹Ÿ LLM çš„ä»£ç†å¾ªç¯æµ‹è¯•

4. **å·¥å…·åˆ†ç±»** (6.1)
   - åˆ†æç°æœ‰å·¥å…·
   - å†³å®šå“ªäº›ä¿ç•™ä¸ºå·¥å…·ï¼Œå“ªäº›è½¬ä¸ºå·¥ä½œæµ
   - åˆ›å»ºè¿ç§»è®¡åˆ’

### ä¸­æœŸè®¡åˆ’ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰

5. **å‰ç«¯æµ‹è¯•** (7.3-7.4)
   - æµ‹è¯•å·¥ä½œæµ UI ç»„ä»¶
   - ç«¯åˆ°ç«¯å·¥ä½œæµæµç¨‹æµ‹è¯•
   - é”™è¯¯å¤„ç†æµ‹è¯•

6. **æ–‡æ¡£æ›´æ–°** (6.3)
   - ç”¨æˆ·æŒ‡å—ï¼šå¦‚ä½•ä½¿ç”¨å·¥ä½œæµ
   - å¼€å‘è€…æŒ‡å—ï¼šå¦‚ä½•åˆ›å»ºå·¥ä½œæµ
   - API æ–‡æ¡£
   - è¿ç§»æŒ‡å—

### é•¿æœŸè®¡åˆ’ï¼ˆä½ä¼˜å…ˆçº§ï¼‰

7. **ä¼˜åŒ–ä¸éƒ¨ç½²** (8.1-8.4)
   - UI æ”¹è¿›
   - ç›‘æ§è®¾ç½®
   - ç”Ÿäº§éƒ¨ç½²
   - æ€§èƒ½ä¼˜åŒ–

---

## âš ï¸ å·²çŸ¥é™åˆ¶

### å½“å‰é™åˆ¶

1. **æ— åŠ¨æ€å·¥ä½œæµåŠ è½½**
   - å·¥ä½œæµå¿…é¡»ç¼–è¯‘åˆ°äºŒè¿›åˆ¶
   - æ— æ³•è¿è¡Œæ—¶æ·»åŠ 
   - ä¸ºäº†ç±»å‹å®‰å…¨çš„å¯æ¥å—æŠ˜è¡·

2. **å‰ç«¯çŠ¶æ€æœºå¤æ‚åº¦**
   - æ—§çš„å·¥å…·çŠ¶æ€ä»å­˜åœ¨ä½†æœªä½¿ç”¨
   - å¯åœ¨æœªæ¥é‡æ„ä¸­æ¸…ç†
   - ä¸å½±å“å½“å‰åŠŸèƒ½

3. **å·¥ä½œæµå®¡æ‰¹ UX**
   - `CreateFileWorkflow` æœ‰ `requires_approval: true` ä½†å°šæœªå¼ºåˆ¶æ‰§è¡Œ
   - å°†åœ¨ä»£ç†å¾ªç¯å®¡æ‰¹é˜¶æ®µå®ç°

4. **æ— ä¸­é—´å·¥å…·è°ƒç”¨æ˜¾ç¤º**
   - ä»£ç†å¾ªç¯çš„å·¥å…·è°ƒç”¨ä¸åœ¨èŠå¤© UI ä¸­æ˜¾ç¤º
   - è®¾è®¡å†³ç­–ï¼šå‰ç«¯ä»…æ¥æ”¶æœ€ç»ˆå“åº”
   - æœªæ¥å¯æ·»åŠ è°ƒè¯•æ¨¡å¼

### æ½œåœ¨é—®é¢˜

1. **å¤§å‹ç³»ç»Ÿæç¤ºè¯**
   - å·¥å…·è¿‡å¤šæ—¶å¯èƒ½è¶…å‡º token é™åˆ¶
   - å½“å‰ç¼“è§£ï¼š32KB å¤§å°é™åˆ¶
   - æœªæ¥ï¼šå·¥å…·é€‰æ‹©/è¿‡æ»¤

2. **ä»£ç†å¾ªç¯æ— é™å¾ªç¯**
   - LLM å¯èƒ½é‡å¤è°ƒç”¨å·¥å…·è€Œä¸ç»ˆæ­¢
   - ç¼“è§£ï¼šæœ€å¤§è¿­ä»£é™åˆ¶ï¼ˆ10æ¬¡ï¼‰
   - éœ€è¦ç›‘æ§

3. **å¹¶å‘å·¥ä½œæµæ‰§è¡Œ**
   - æœªæµ‹è¯•å¤šä¸ªåŒæ—¶å·¥ä½œæµ
   - æ–‡ä»¶æ“ä½œå¯èƒ½éœ€è¦é”
   - éœ€è¦æµ‹è¯•

---

## ğŸ“ å…³é”®è®¾è®¡å†³ç­–

### 1. åç«¯ç®¡ç†ç³»ç»Ÿæç¤ºè¯å¢å¼º

**å†³ç­–ï¼š** å°†æç¤ºè¯å¢å¼ºä»å‰ç«¯ç§»è‡³åç«¯  
**ç†ç”±ï¼š**

- å•ä¸€çœŸå®æ¥æº
- æ›´å¥½çš„ç¼“å­˜å’Œæ€§èƒ½
- æ‰€æœ‰å®¢æˆ·ç«¯çš„ä¸€è‡´å¢å¼º
- æ›´å®¹æ˜“ç»´æŠ¤å·¥å…·å®šä¹‰

### 2. å·¥ä½œæµä¸å·¥å…·åˆ†ç¦»

**å†³ç­–ï¼š** æ¸…æ™°åˆ†ç¦»ç”¨æˆ·è°ƒç”¨çš„å·¥ä½œæµå’Œ LLM è°ƒç”¨çš„å·¥å…·  
**ç†ç”±ï¼š**

- ä¸åŒçš„ UX æ¨¡å¼ï¼ˆæ˜¾å¼ vs. è‡ªä¸»ï¼‰
- ä¸åŒçš„å®¡æ‰¹æµç¨‹ï¼ˆé¢„å®¡æ‰¹ vs. è¿è¡Œæ—¶å®¡æ‰¹ï¼‰
- ç”¨æˆ·æ›´æ¸…æ™°çš„å¿ƒæ™ºæ¨¡å‹

### 3. åç«¯ä»£ç†å¾ªç¯ç¼–æ’

**å†³ç­–ï¼š** åç«¯ç®¡ç†ä»£ç†å¾ªç¯ï¼Œè€Œéå‰ç«¯  
**ç†ç”±ï¼š**

- é›†ä¸­æ§åˆ¶å’Œç›‘æ§
- å®¢æˆ·ç«¯é—´çš„ä¸€è‡´è¡Œä¸º
- æ›´å¥½çš„é”™è¯¯å¤„ç†
- æ›´å®¹æ˜“å®ç°å®¡æ‰¹é—¨æ§

### 4. ç¼–è¯‘æ—¶å·¥ä½œæµæ³¨å†Œ

**å†³ç­–ï¼š** ä½¿ç”¨ `inventory` crate è¿›è¡Œç¼–è¯‘æ—¶æ³¨å†Œ  
**ç†ç”±ï¼š**

- é›¶è¿è¡Œæ—¶æˆæœ¬
- ç±»å‹å®‰å…¨æ³¨å†Œ
- æ— éœ€æ‰‹åŠ¨æ³¨å†Œè¡¨æ›´æ–°
- è‡ªåŠ¨å‘ç°

---

## ğŸ“ ç»éªŒæ•™è®­

### åšå¾—å¥½çš„ âœ…

1. **OpenSpec é©±åŠ¨å¼€å‘**
   - æ¸…æ™°çš„ tasks.md æ¸…å•ä¿æŒè¿›åº¦å¯è§
   - è®¾è®¡å†³ç­–æå‰è®°å½•
   - æ˜“äºè·Ÿè¸ªè¿›åº¦

2. **åç«¯ä¼˜å…ˆæ–¹æ³•**
   - å‰ç«¯é›†æˆå‰åç«¯ç¨³å®šæ€§
   - æ›´å®¹æ˜“è°ƒè¯•å’Œæµ‹è¯•
   - æ¸…æ™°çš„ API å¥‘çº¦

3. **ç¼–è¯‘æ—¶æ³¨å†Œ**
   - é›¶è¿è¡Œæ—¶æˆæœ¬
   - ç±»å‹å®‰å…¨
   - æ˜“äºæ‰©å±•

4. **å¢é‡å‰ç«¯é‡æ„**
   - ç¦ç”¨æ—§ä»£ç è€Œéç«‹å³åˆ é™¤
   - éœ€è¦æ—¶æ›´å®¹æ˜“å›æ»š
   - é£é™©æ›´ä½

### å¯ä»¥æ”¹è¿›çš„ ğŸ”„

1. **æµ‹è¯•åº”è¯¥å¹¶å‘è¿›è¡Œ**
   - æµ‹è¯•åº”ä¸å®ç°ä¸€èµ·ç¼–å†™
   - å½“å‰å·®è·ä½¿é‡æ„æœ‰é£é™©
   - æ•™è®­ï¼šTDD æˆ–è‡³å°‘å¹¶å‘æµ‹è¯•

2. **å‰ç«¯/åç«¯åè°ƒ**
   - API ä¸åŒ¹é…ï¼ˆ`name` vs `workflow_name`ï¼‰åº”è¯¥æ›´æ—©å‘ç°
   - éœ€è¦æ›´å¥½çš„å¥‘çº¦æµ‹è¯•
   - ä½¿ç”¨ OpenAPI/TypeScript ä»£ç ç”Ÿæˆï¼Ÿ

3. **æ–‡æ¡£æ»å**
   - å¼€å‘æœŸé—´æœªæ›´æ–°å¤–éƒ¨æ–‡æ¡£
   - ç”¨æˆ·æŒ‡å—ä»ä¸å®Œæ•´
   - æ•™è®­ï¼šæ¯ä¸ª PR/ä»»åŠ¡æ›´æ–°æ–‡æ¡£

4. **æ€§èƒ½æµ‹è¯•**
   - åº”è¯¥æ—©æœŸå»ºç«‹åŸºå‡†
   - éš¾ä»¥çŸ¥é“æ˜¯å¦éœ€è¦ä¼˜åŒ–
   - æ•™è®­ï¼šä¼˜åŒ–å‰åéƒ½è¦åŸºå‡†æµ‹è¯•

---

## ğŸ“š æ–‡æ¡£ç´¢å¼•

### OpenSpec å˜æ›´æ–‡æ¡£

- **ææ¡ˆï¼š** `openspec/changes/refactor-tools-to-llm-agent-mode/proposal.md`
- **ä»»åŠ¡ï¼š** `openspec/changes/refactor-tools-to-llm-agent-mode/tasks.md`
- **è®¾è®¡ï¼š** `openspec/changes/refactor-tools-to-llm-agent-mode/design.md`
- **çŠ¶æ€ï¼š** `openspec/changes/refactor-tools-to-llm-agent-mode/STATUS.md`

### è§„æ ¼æ–‡æ¡£

- **å·¥ä½œæµç³»ç»Ÿï¼š** `openspec/changes/refactor-tools-to-llm-agent-mode/specs/workflow-system/spec.md`
- **ç³»ç»Ÿæç¤ºè¯å¢å¼ºï¼š** `openspec/changes/refactor-tools-to-llm-agent-mode/specs/system-prompt-enhancement/spec.md`
- **å‰ç«¯å·¥ä½œæµ UIï¼š** `openspec/changes/refactor-tools-to-llm-agent-mode/specs/frontend-workflow-ui/spec.md`

### ä»£ç ç´¢å¼•

**åç«¯å…³é”®æ–‡ä»¶ï¼š**

```
crates/workflow_system/src/
  - types/workflow.rs          # Workflow trait å®šä¹‰
  - registry/registries.rs     # æ³¨å†Œæœºåˆ¶
  - executor.rs                # æ‰§è¡Œå¼•æ“
  - examples/echo_workflow.rs  # Echo å·¥ä½œæµç¤ºä¾‹

crates/web_service/src/
  - services/agent_service.rs          # ä»£ç†æœåŠ¡
  - services/system_prompt_enhancer.rs # æç¤ºè¯å¢å¼º
  - services/workflow_service.rs       # å·¥ä½œæµæœåŠ¡
  - controllers/workflow_controller.rs # å·¥ä½œæµ API
```

**å‰ç«¯å…³é”®æ–‡ä»¶ï¼š**

```
src/
  - services/WorkflowService.ts           # å·¥ä½œæµæœåŠ¡
  - components/WorkflowSelector/          # é€‰æ‹©å™¨ç»„ä»¶
  - components/WorkflowParameterForm/     # å‚æ•°è¡¨å•
  - components/WorkflowExecutionFeedback/ # æ‰§è¡Œåé¦ˆ
  - hooks/useChatManager.ts               # èŠå¤©ç®¡ç†
  - core/chatInteractionMachine.ts        # çŠ¶æ€æœº
```

---

## ğŸ” éªŒè¯ä¸æµ‹è¯•

### æ‰‹åŠ¨æµ‹è¯•æ¸…å•

#### âœ… å·¥ä½œæµæ‰§è¡Œ

```bash
# åç«¯ API æµ‹è¯•
curl -X POST http://localhost:8080/v1/workflows/execute \
  -H "Content-Type: application/json" \
  -d '{
    "workflow_name": "create_file",
    "parameters": {
      "path": "/tmp/test.txt",
      "content": "Hello World"
    }
  }'

# éªŒè¯æ–‡ä»¶åˆ›å»º
cat /tmp/test.txt
# é¢„æœŸè¾“å‡º: Hello World
```

#### âœ… å‰ç«¯å·¥ä½œæµé€‰æ‹©å™¨

1. åœ¨èŠå¤©è¾“å…¥æ¡†è¾“å…¥ `/`
2. å·¥ä½œæµé€‰æ‹©å™¨å‡ºç°
3. è¾“å…¥ `echo`
4. `echo` å·¥ä½œæµé«˜äº®
5. æŒ‰ Enter
6. å‚æ•°è¡¨å•å‡ºç°
7. å¡«å†™ `message` å­—æ®µ
8. ç‚¹å‡»æ‰§è¡Œ
9. æˆåŠŸæç¤ºå‡ºç°

#### âœ… å¢å¼ºæç¤ºè¯ API

```bash
curl http://localhost:8080/v1/system-prompts/default/enhanced
# é¢„æœŸ: JSON åŒ…å« tools éƒ¨åˆ†
```

### è‡ªåŠ¨åŒ–æµ‹è¯•çŠ¶æ€

- âŒ åç«¯å•å…ƒæµ‹è¯•: æœªå®ç°
- âŒ åç«¯é›†æˆæµ‹è¯•: æœªå®ç°
- âŒ å‰ç«¯å•å…ƒæµ‹è¯•: æœªå®ç°
- âŒ E2E æµ‹è¯•: æœªå®ç°

---

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### å¦‚ä½•åˆ›å»ºæ–°å·¥ä½œæµ

1. **åˆ›å»ºå·¥ä½œæµæ–‡ä»¶ï¼š**

```rust
// crates/workflow_system/src/examples/my_workflow.rs
use async_trait::async_trait;
use crate::types::{Workflow, WorkflowDefinition, Parameter};

#[derive(Debug, Default)]
pub struct MyWorkflow;

#[async_trait]
impl Workflow for MyWorkflow {
    fn definition(&self) -> WorkflowDefinition {
        WorkflowDefinition {
            name: "my_workflow".to_string(),
            description: "æˆ‘çš„è‡ªå®šä¹‰å·¥ä½œæµ".to_string(),
            parameters: vec![
                Parameter {
                    name: "param1".to_string(),
                    description: "å‚æ•°æè¿°".to_string(),
                    required: true,
                    param_type: "string".to_string(),
                    default: None,
                }
            ],
            category: "general".to_string(),
            requires_approval: false,
            custom_prompt: None,
        }
    }

    async fn execute(
        &self,
        parameters: HashMap<String, serde_json::Value>,
    ) -> Result<serde_json::Value, WorkflowError> {
        // å®ç°é€»è¾‘
        Ok(serde_json::json!({"success": true}))
    }
}

// æ³¨å†Œå·¥ä½œæµ
register_workflow!(MyWorkflow, "my_workflow");
```

2. **å¯¼å‡ºå·¥ä½œæµï¼š**

```rust
// crates/workflow_system/src/examples/mod.rs
mod my_workflow;
pub use my_workflow::MyWorkflow;
```

3. **é‡æ–°ç¼–è¯‘å¹¶æµ‹è¯•ï¼š**

```bash
cargo build
# å·¥ä½œæµè‡ªåŠ¨å¯ç”¨
curl http://localhost:8080/v1/workflows/available | jq '.workflows[] | select(.name=="my_workflow")'
```

### å¦‚ä½•ä½¿ç”¨å·¥ä½œæµï¼ˆç”¨æˆ·è§†è§’ï¼‰

1. **æ‰“å¼€èŠå¤©ç•Œé¢**
2. **è¾“å…¥ `/`** - å·¥ä½œæµé€‰æ‹©å™¨å¼¹å‡º
3. **æµè§ˆæˆ–æœç´¢** - è¾“å…¥å·¥ä½œæµåç§°è¿›è¡Œè¿‡æ»¤
4. **é€‰æ‹©å·¥ä½œæµ** - ç‚¹å‡»æˆ–æŒ‰ Enter
5. **å¡«å†™å‚æ•°** - åœ¨åŠ¨æ€è¡¨å•ä¸­è¾“å…¥
6. **æ‰§è¡Œ** - ç‚¹å‡» "Execute" æŒ‰é’®
7. **æŸ¥çœ‹ç»“æœ** - æˆåŠŸ/é”™è¯¯æç¤ºå‡ºç°

---

## ğŸ¯ æˆåŠŸæ ‡å‡†

### å½“å‰é˜¶æ®µå®Œæˆå®šä¹‰

âœ… **å·²å®Œæˆï¼š**

- [x] å¯ä»¥åˆ›å»ºå’Œæ³¨å†Œå·¥ä½œæµ
- [x] å¯ä»¥é€šè¿‡ API æ‰§è¡Œå·¥ä½œæµ
- [x] å‰ç«¯å¯ä»¥åˆ—å‡ºå’Œé€‰æ‹©å·¥ä½œæµ
- [x] å‰ç«¯å¯ä»¥ä½¿ç”¨å‚æ•°æ‰§è¡Œå·¥ä½œæµ
- [x] ç³»ç»Ÿæç¤ºè¯ç”±åç«¯å¢å¼º
- [x] ä»£ç†æœåŠ¡åŸºç¡€å®Œæˆ
- [x] ç”¨æˆ·è°ƒç”¨çš„å·¥ä½œæµæ— éœ€å®¡æ‰¹å¼¹çª—

âŒ **å¾…å®Œæˆï¼š**

- [ ] ä»£ç†å¾ªç¯ä¸ OpenAI æ§åˆ¶å™¨é›†æˆ
- [ ] å·¥å…·å®¡æ‰¹æœºåˆ¶å·¥ä½œ
- [ ] å…¨é¢æµ‹è¯•è¦†ç›–
- [ ] æ–‡æ¡£å®Œæ•´
- [ ] ç”Ÿäº§éƒ¨ç½²å°±ç»ª

### å…¨é¢å®Œæˆçš„æ¥å—æ ‡å‡†

1. **åŠŸèƒ½æ€§ï¼š**
   - LLM å¯ä»¥è‡ªä¸»è°ƒç”¨å·¥å…·
   - éœ€è¦å®¡æ‰¹çš„å·¥å…·æ˜¾ç¤ºå¼¹çª—
   - å·¥ä½œæµæ— éœ€å®¡æ‰¹å³å¯æ‰§è¡Œ
   - ä»£ç†å¾ªç¯æ­£ç¡®ç»ˆæ­¢

2. **è´¨é‡ï¼š**
   - > 80% æµ‹è¯•è¦†ç›–ç‡
   - <100ms p95 å·¥ä½œæµæ‰§è¡Œ
   - <500ms p95 ä»£ç†å¾ªç¯
   - é›¶å·²çŸ¥ä¸¥é‡ bug

3. **æ–‡æ¡£ï¼š**
   - å·¥ä½œæµç”¨æˆ·æŒ‡å—
   - åˆ›å»ºå·¥ä½œæµå¼€å‘è€…æŒ‡å—
   - API æ–‡æ¡£å®Œæ•´
   - è¿ç§»æŒ‡å—å‘å¸ƒ

4. **éƒ¨ç½²ï¼š**
   - éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
   - ç›‘æ§ä»ªè¡¨æ¿æ¿€æ´»
   - å›æ»šæµ‹è¯•å®Œæˆ
   - æ”¶é›†ç”¨æˆ·åé¦ˆ

---

## ğŸ“ è”ç³»æ–¹å¼

**å®æ–½è´Ÿè´£äººï¼š** AI åŠ©æ‰‹  
**æœ€åå®¡æŸ¥ï¼š** 2025-11-02  
**ä¸‹æ¬¡å®¡æŸ¥ï¼š** å¾…å®šï¼ˆä»£ç†å¾ªç¯å®Œæˆåï¼‰

**æœ‰é—®é¢˜ï¼Ÿ**

- æŸ¥çœ‹ `openspec/changes/refactor-tools-to-llm-agent-mode/design.md` äº†è§£æŠ€æœ¯å†³ç­–
- æŸ¥çœ‹ `openspec/changes/refactor-tools-to-llm-agent-mode/proposal.md` äº†è§£ç†ç”±
- æŸ¥çœ‹ `openspec/changes/refactor-tools-to-llm-agent-mode/tasks.md` äº†è§£ä»»åŠ¡è¯¦æƒ…
- æŸ¥çœ‹ `openspec/changes/refactor-tools-to-llm-agent-mode/STATUS.md` äº†è§£è¯¦ç»†çŠ¶æ€ï¼ˆè‹±æ–‡ï¼‰

---

**éªŒè¯çŠ¶æ€ï¼š** âœ… OpenSpec æ ¼å¼éªŒè¯é€šè¿‡







